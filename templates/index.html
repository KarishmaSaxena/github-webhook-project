<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Events Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <h1>GitHub Events Dashboard</h1>

    <label>Filter by event:
        <select id="eventFilter">
            <option value="all">All</option>
            <option value="push">Push</option>
            <option value="pull_request_opened">Pull Request</option>
            <option value="merge">Merge</option>
            <option value="issue_opened">Issue</option>
        </select>
    </label>

    <input type="text" id="searchInput" placeholder="Enter branch name or issue title">

    <table id="eventsTable">
        <thead>
            <tr>
                <th>Author</th>
                <th>Action</th>
                <th>From Branch</th>
                <th>To Branch / Title</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function fetchEvents() {
            const res = await fetch("/events");
            let events = await res.json();

            const filter = document.getElementById("eventFilter").value;
            const search = document.getElementById("searchInput").value.toLowerCase();

            if (filter !== "all") {
                events = events.filter(e => e.action === filter);
            }

            if (search) {
                events = events.filter(e =>
                    (e.to_branch || e.title || "").toLowerCase().includes(search)
                );
            }

            const tbody = document.querySelector("#eventsTable tbody");
            tbody.innerHTML = "";

            events.forEach(e => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
          <td>${e.author}</td>
          <td>${e.action}</td>
          <td>${e.from_branch || ""}</td>
          <td>${e.to_branch || e.title || ""}</td>
          <td>${e.timestamp}</td>
        `;
                tbody.appendChild(tr);
            });
        }

        fetchEvents();
        setInterval(fetchEvents, 15000);

        document.getElementById("eventFilter").addEventListener("change", fetchEvents);
        document.getElementById("searchInput").addEventListener("input", fetchEvents);
    </script>
</body>

</html>